<<<<<<< HEAD
---
title: "Journées de l'UMI SOURCE "
author: "Lenaïg MOIGN, Florent Bédécarrats"
format:
  html:
    output-file: "index"
    output-ext: "htm"
    toc: true
editor: visual
execute:
  warning: false
  error: false
---

## CHARGEMENT DES LIBRAIRIES

gjeheuzknnzoe

```{r}
# INSTALLATION DES LIBRAIRIES R 

librairies_req <- c("tidyverse",# Une série de packages pour faciliter la manipulation de données
                    "readxl", # Pour lire les fichiers excel (Carvalho et al. 2018)
                    "writexl",# Pour écrire des fichiers excel 
                    "sf", # Pour faciliter la manipulation de données géographiques
                    "maptiles", # Pour télécharger des fonds de carte 
                    "geodata", # Pour télécharger simplement les frontières administratives
                    "tidygeocoder", # Pour obtenir les coordonnées GPS d'un point à partir de son nom 
                    "tmap",# Pour produire de jolies cartes 
                    "wdpar", # Pour télécharger la base d'aires protégées WDPA
                    "mapme.biodiversity") # Pour importer et analyser des indicateurs de biodiversité

# CHARGEMENT DES LIBRAIRIES

library(tidyverse)
library(geodata)
library(sf)
library(tmap)
library(wdpar)

```

## CHARGEMENT DES DONNEES

fgrgrht

```{r}
#TELECHARGEMENT DES DONNEES DU WDPA 

WDPA_Senegal <- wdpa_fetch("Senegal", wait = TRUE, 
                          download_dir = "data/WDPA")

```

## EXPLORATION DES DONNEES

Quels types de géométrie ? Quel système de projection ?

```{r}

# CONNAITRE LES GEOMETRIES DE LA COUCHE (POINTS, LIGNES, POLYGONES) 

WDPA_Senegal %>%
  mutate(geom_type = st_geometry_type(.)) %>%  # Ajout d'une colonne pour les catégories de géométries
  group_by(geom_type) %>%  # Tri des données en fonction de leur catégorie  
  summarise(n = n()) # Résumé pour chaque catégorie de géométrie

# CONNAITRE LE SYSTEME DE PROJECTION 

crs(WDPA_Senegal)

```

Pour aller plus loin : ajuster manuellement le système de projection

## EXPLORER LES DONNEES 

# Connaître la nombre d'aires protégées et leur superficie totale par année de création 

```{r}
AP_Annees <- WDPA_Senegal %>%
  filter(st_geometry_type(.) == "MULTIPOLYGON") %>% # Sélection des polygones 
  mutate(GIS_AREA= st_area(.), # Création d'une colonne avec la superficie de chaque polygone 
         GIS_AREA= units::set_units(GIS_AREA, "km2"))%>% # Conversion de l'unité en km² 
  group_by(STATUS_YR) %>% # Groupement des données par année de création de l'aire protégée 
  summarise(n = n(), # Calcul du nombre d'observations pour chaque année dans une colonne de l'effectif n
            area = sum(GIS_AREA)) %>% # Somme des superficies pour chaque groupe dans une colonne area  
  arrange(STATUS_YR) #Tri des données par ordre croissant

```

# Connaître le nombre d'aires protégée par mandat présidentiel 

```{r}

# Créer une variable pour définir les périodes

WDPA_mandats <- WDPA_Senegal %>%
  filter(STATUS_YR != 0) %>% # On exclut les AP dont l'année de création n'est pas renseignée
  mutate(Periode = cut(STATUS_YR, breaks = c(1981, 2000, 2012, 2020),
                       labels = c("1981-2000", "2000-2012", "2012-2020"),
                       include.lowest = TRUE)) %>% # On créée des catégories de période (mandats)
  filter(!is.na(Periode)) # On exclut les valeurs NA correspondant aux années avant 1981 


# Calculer l'effectif total d'aires protégées sur les 3 mandats 

AP_mandats <- WDPA_mandats %>%
  filter(st_geometry_type(.) == "MULTIPOLYGON" & Periode != "NA") %>% # Sélection des polygones 
  group_by(Periode) %>% # Groupement des données par période de création de l'aire protégée 
  summarise(Effectif_total = n()) %>%  # Calcul du nombre d'observations pour chaque année 
  arrange(Periode) %>% #Tri des données par ordre croissant
  mutate(Nom = c("ABDOU DIOUF", "ABDOULAYE WADE", "MACKY SALL")) %>%

# Création d'un beau tableau (ne fonctionne pas) 
gt() %>%
  tab_header("Nombre de création d'aires protégées durant les derniers mandats présidentiels au Sénégal") %>%
  tab_source_note("Source : Données du WDPA (juin 2023)")%>%

#Difficultés pour renommer les colonnes

```

## CONNAITRE LES DONNEES MANQUANTES

```{r}
# VERIFIER LES VALEURS MANQUANTES 

AP_Senegal_of %>%
  st_drop_geometry() %>%
  summarise("Nombre total d'aires protégées" = n(),
            "Catégorie IUCN manquante" = sum(IUCN_CAT == "Not Reported"),
            "Année de création manquante" = sum(STATUS_YR == 0),
            "Gestionnaire manquant" = sum(MANG_AUTH == "Not Reported")) %>%
  pivot_longer(cols = everything(),
               names_to = " ",
               values_to = "Nombre d'aires") %>%
  gt() %>%
  tab_header("Valeurs manquantes dans les données WDPA pour le Sénégal") %>%
  tab_source_note("Source : WDPA (juin 2023)")

```

## VISUALER LES DONNEES GEOGRAPHIQUES 

# Carte 1 (Catégorie IUCN)

```{r}
# RENDU CARTO

tmap_mode(mode = "view")
# tm_shape(contour_senegal) +
# tm_borders() + 
tm_shape(WDPA_Senegal) + 
tm_polygons(col = "IUCN_CAT", alpha = 0.6, title = "Catégorie IUCN",
            id = "NAME", 
            popup.vars = c("Type" = "DESIG", 
                            "Catégorie IUCN" = "IUCN_CAT",
                            "Surface déclarée" = "REP_AREA",
                            "Année du statut" = "STATUS_YR"))
#ADITIONAL OPTIONS 

tmap_options(check.and.fix = TRUE)

```

# Carte 2 (Catégorie d'aires protégées) 

```{r}
tmap_mode(mode = "view") 
tm_shape(contour_senegal) +
  tm_borders() + 
  tm_shape(WDPA_Senegal) + 
  tm_polygons(col = "DESIG", alpha = 0.6, title = "Catégories d'aires protégées",
              id = "NAME", 
              popup.vars = c("Type" = "DESIG", 
                             "Catégorie IUCN" = "IUCN_CAT",
                             "Surface déclarée" = "REP_AREA",
                             "Année du statut" = "STATUS_YR"))
```

# Carte 3 (Date de création)

A VENIR

# Carte 4 (Aires marines et aires terrestres)

Problème au niveau du géo-traitement de la fonction st()
Résultats différents sur qGIS que lors de l'application des traitements sur R

```{r}

# Création d'intersection 

# On ne garde que les polygones (sans les points)

WDPA_Senegal_poly <- WDPA_Senegal %>% 
  filter(st_geometry_type(.) == "MULTIPOLYGON")

# On différencie par géo-traitement les aires marines et terrestres 

WDPA_Senegal_poly_terrestre <- st_intersection(WDPA_Senegal_poly,contour_senegal)

WDPA_Senegal_poly_marin <-  st_difference(WDPA_Senegal_poly, contour_senegal)

```


## SUPERPOSITION DES AIRES PROTEGEES

à venir 

## ACQUISITION DE DONNEES ET CALCUL D'INDICATEURS

# Constitution d'un porte-feuille 

```{r}

#  Constitution d'un portefeuille (voir la documentation)

# Exécuter la fonction init_portfolio

WDPA_Senegal_poly <- init_portfolio(x = WDPA_Senegal_poly, 
                                     years = 1980:2020,
                                     outdir = "data/mapme_Senegal",
                                     add_resources = TRUE,
                                     verbose = TRUE)
```

On réfléchit à quelles données on souhaite récupérer et analyser. On vérifie
leur disponibilité dans le package mapme.biodiversity() 

```{r}

get_resources()
available_resources()

```

On récupère les données sur la mangrove de la plateforme Global Mangrove Watch 

```{r}

# Chargement des données du GMW

WDPA_Senegal_poly <- get_resources(x = WDPA_Senegal_poly,resource = "gmw")

```

Réléchir à d'autres indicateurs pertinents 

Puis focus sur la Réserve de la Somone 

=======
---
title: "Journées de l'UMI SOURCE"
author: "Lenaïg MOIGN, Florent Bédécarrats"
format:
  html:
    output-file: "index"
    output-ext: "htm"
    toc: true
editor: visual
execute:
  warning: false
  error: false
---

## CHARGEMENT DES LIBRAIRIES

gjeheuzknnzoe

```{r}
# INSTALLATION DES LIBRAIRIES R 

librairies_req <- c("tidyverse",# Une série de packages pour faciliter la manipulation de données
                    "readxl", # Pour lire les fichiers excel (Carvalho et al. 2018)
                    "writexl",# Pour écrire des fichiers excel 
                    "sf", # Pour faciliter la manipulation de données géographiques
                    "maptiles", # Pour télécharger des fonds de carte 
                    "geodata", # Pour télécharger simplement les frontières administratives
                    "tidygeocoder", # Pour obtenir les coordonnées GPS d'un point à partir de son nom 
                    "tmap",# Pour produire de jolies cartes 
                    "wdpar", # Pour télécharger la base d'aires protégées WDPA
                    "mapme.biodiversity") # Pour importer et analyser des indicateurs de biodiversité

# CHARGEMENT DES LIBRAIRIES

library(tidyverse)
library(geodata)
library(sf)
library(tmap)
library(wdpar)

```

## CHARGEMENT DES DONNEES

fgrgrht

```{r}
#TELECHARGEMENT DES DONNEES DU WDPA 

WDPA_Senegal <- wdpa_fetch("Senegal", wait = TRUE, 
                          download_dir = "data/WDPA")

```

## EXPLORATION DES DONNEES

Quels types de géométrie ? Quel système de projection ?

```{r}

# CONNAITRE LES GEOMETRIES DE LA COUCHE (POINTS, LIGNES, POLYGONES) 

WDPA_Senegal %>%
  mutate(geom_type = st_geometry_type(.)) %>%  # Ajout d'une colonne pour les catégories de géométries
  group_by(geom_type) %>%  # Tri des données en fonction de leur catégorie  
  summarise(n = n()) # Résumé pour chaque catégorie de géométrie

# CONNAITRE LE SYSTEME DE PROJECTION 

crs(WDPA_Senegal)

```

Pour aller plus loin : ajuster manuellement le système de projection

## DECRIRE LES DONNEES (TABLEAU DESCRIPTIF)

Connaître les années de création

```{r}
AP_Annees <- WDPA_Senegal %>%
  filter(st_geometry_type(.) == "MULTIPOLYGON") %>% # Sélection des polygones 
  mutate(GIS_AREA= st_area(.), # Création d'une colonne avec la superficie de chaque polygone 
         GIS_AREA= units::set_units(GIS_AREA, "km2"))%>% # Conversion de l'unité en km² 
  group_by(STATUS_YR) %>% # Groupement des données par année de création de l'aire protégée 
  summarise(n = n(), # Calcul du nombre d'observations pour chaque année dans une colonne de l'effectif n
            area = sum(GIS_AREA)) %>% # Somme des superficies pour chaque groupe dans une colonne area  
  arrange(STATUS_YR) #Tri des données par ordre croissant

```

Attirer l'attention sur le double pipe operator pour comprendre la logique de création du tableau

Afficher le nom des aires protégées créées en 2020 Afficher le nombre des aires protégées créées entre \[1981-2000\] ; \[2000-2012\] ; \[2012-2023\]

## CONNAITRE LES DONNEES MANQUANTES

```{r}
# VERIFIER LES VALEURS MANQUANTES 

AP_Senegal_of %>%
  st_drop_geometry() %>%
  summarise("Nombre total d'aires protégées" = n(),
            "Catégorie IUCN manquante" = sum(IUCN_CAT == "Not Reported"),
            "Année de création manquante" = sum(STATUS_YR == 0),
            "Gestionnaire manquant" = sum(MANG_AUTH == "Not Reported")) %>%
  pivot_longer(cols = everything(),
               names_to = " ",
               values_to = "Nombre d'aires") %>%
  gt() %>%
  tab_header("Valeurs manquantes dans les données WDPA pour le Sénégal") %>%
  tab_source_note("Source : WDPA (juin 2023)")

```

## VISUALER LES DONNEES GEOGRAPHIQUES (CARTE DESCRIPTIVE)

```{r}
# RENDU CARTO

tmap_mode(mode = "view")
# tm_shape(contour_senegal) +
# tm_borders() + 
tm_shape(WDPA_Senegal) + 
tm_polygons(col = "IUCN_CAT", alpha = 0.6, title = "Catégorie IUCN",
            id = "NAME", 
            popup.vars = c("Type" = "DESIG", 
                            "Catégorie IUCN" = "IUCN_CAT",
                            "Surface déclarée" = "REP_AREA",
                            "Année du statut" = "STATUS_YR"))
#ADITIONAL OPTIONS 

tmap_options(check.and.fix = TRUE)

```

## ACQUISITION DE DONNEES ET CALCUL D'INDICATEURS
>>>>>>> e7a8c4160ee1a7827ded92925d0a7db08c2c5c99
